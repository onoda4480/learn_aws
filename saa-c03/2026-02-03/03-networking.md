# ネットワーク

## VPC / VPN / Direct Connect

### 役割の違い
```
VPC            = AWS上のネットワーク空間（場所）
AWS VPN        = VPCへの接続方法（インターネット経由）
Direct Connect = VPCへの接続方法（専用線経由）
```

### 構成図
```
オンプレ（自社サーバー）          AWS
┌──────────┐               ┌──────────────┐
│          │── VPN ──────→│              │
│  社内    │  (ネット経由)   │    VPC       │
│ ネット   │               │  (仮想ネット)  │
│ ワーク   │── Direct ───→│              │
│          │   Connect     │              │
└──────────┘  (専用線)      └──────────────┘
```

### VPN vs Direct Connect

| 項目 | AWS VPN | Direct Connect |
|-----|---------|---------------|
| 経由 | インターネット | 専用線 |
| 速度 | 回線次第（不安定） | 安定（1Gbps〜100Gbps） |
| 遅延 | 高め | 低い |
| 料金 | 安い | 高い |
| 導入期間 | 即日 | 数週間〜数ヶ月 |

### 選び方
```
小規模・リモートワーク → VPN
大量データ転送・基幹システム → Direct Connect
両方組み合わせ → Direct Connect + VPNバックアップ
```

---

## 一般的な通信構成

### 入ってくる通信（ユーザー → アプリ）
```
インターネット → IGW → ALB → プライベートサブネット
```

### 出ていく通信（アプリ → 外部）
```
プライベートサブネット → NAT GW → IGW → インターネット
```

### 全体像
```
                    インターネット
                         │
              ┌─────────────────────┐
              │ インターネットGW      │
              └─────────────────────┘
                         │
         ┌───────────────┴───────────────┐
         ▼                               ▼
┌─────────────────┐             ┌─────────────────┐
│ パブリックサブネット│             │ パブリックサブネット│
│  ┌───────────┐  │             │  ┌───────────┐  │
│  │ ALB       │  │             │  │ NAT GW    │  │
│  └───────────┘  │             │  └───────────┘  │
└─────────────────┘             └─────────────────┘
         │ 入ってくる通信                  ▲ 出ていく通信
         ▼                               │
┌─────────────────────────────────────────────────┐
│              プライベートサブネット                │
│  ┌───────┐  ┌───────┐  ┌───────┐               │
│  │ EC2   │  │ RDS   │  │ ECS   │               │
│  └───────┘  └───────┘  └───────┘               │
└─────────────────────────────────────────────────┘
```

---

## ALB（Application Load Balancer）

Webリクエストを複数サーバーに振り分けるサービス

### 機能
- 負荷分散（リクエストを複数サーバーに分散）
- ヘルスチェック（落ちたサーバーには送らない）
- SSL終端（HTTPSの処理を代行）
- パスベースルーティング（/api は EC2、/images は S3 等）

### ロードバランサーの種類

| 種類 | 用途 | レイヤー |
|-----|------|---------|
| ALB | Webアプリ（HTTP/HTTPS） | L7（アプリ層） |
| NLB | 高速・大量接続（TCP/UDP） | L4（トランスポート層） |

---

## NATゲートウェイ

プライベートサブネットからインターネットへの「出る専用の門」

```
✅ できること：プライベートサブネット → インターネット
✗ できないこと：インターネット → プライベートサブネット
```
