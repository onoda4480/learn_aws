# ストレージ

## EBS / EFS / S3 の違い

### 一言で言うと
```
EBS = ディスク（HDD/SSD） → EC2専用
EFS = 共有フォルダ → 複数EC2から同時アクセス
S3  = ファイル倉庫 → API経由でどこからでも
```

### 比較表

| 項目 | EBS | EFS | S3 |
|-----|-----|-----|-----|
| 種類 | ブロックストレージ | ファイルストレージ | オブジェクトストレージ |
| 共有 | 1台のみ | 複数台OK | 複数台OK |
| 使い方 | HDDとして | フォルダとして | API経由 |
| 直接編集 | できる | できる | できない |
| アクセス元 | 同AZ内のEC2 | VPC内 | どこからでも |
| 料金 | 安い | やや高い | 最安 |
| 用途 | OS、DBなど | 共有ファイル | 画像、バックアップ |

---

## EBS（Elastic Block Storage）

EC2に繋げる仮想HDD/SSD

### 特徴
- EC2に必須（OSが入ってる）
- EC2を止めてもデータが消えない
- 同じAZ内のEC2にしか繋げない
- スナップショット（バックアップ）が取れる

### ボリュームタイプ

| タイプ | 種類 | 用途 |
|-------|------|------|
| gp3 / gp2 | 汎用SSD | 一般的な用途（デフォルト） |
| io2 / io1 | プロビジョンドIOPS SSD | DB等の高性能用途 |
| st1 | スループット最適化HDD | ログ、ビッグデータ |
| sc1 | コールドHDD | アクセス頻度が低いデータ |

### スナップショット
- ディスクのバックアップ → S3 に保存
- 別のAZ・別リージョンで復元可能
- DR（災害復旧）に使える

---

## EFS（Elastic File System）

複数のサーバーから同時にアクセスできる共有ストレージ

- NFS プロトコルで通信
- フォルダのように直接読み書き可能
- EC2, ECS どちらからも使える

### NFS（Network File System）とは
ネットワーク経由でファイルを共有するプロトコル（規格）。EFSはNFSを使って通信している。

---

## Amazon FSx for Lustre

超高速ファイルシステム（EFSの高速版）

- スループット：数百GB/s（EFSの100倍以上）
- 用途：機械学習、動画レンダリング、シミュレーション
- S3と連携（普段はS3に保存、処理時だけFSxにロード）

### FSx シリーズ
| 種類 | 用途 |
|-----|------|
| FSx for Lustre | 超高速処理向け |
| FSx for Windows | Windowsファイル共有 |
| FSx for NetApp | NetApp機能が必要な時 |
| FSx for OpenZFS | ZFSが必要な時 |

---

## 階層型ストレージ

アクセス頻度でデータを仕分けし、適切な場所に保存する仕組み

```
よく使う     → 高速・高い（S3 Standard: $0.023/GB）
たまに使う   → 中間（S3 Standard-IA: $0.0125/GB）
ほぼ使わない → 低速・安い（S3 Glacier: $0.004/GB）
年1回以下   → 最安（S3 Glacier Deep Archive: $0.00099/GB）
```

### S3 Intelligent-Tiering
アクセスパターンを監視して自動で階層を移動。手動管理不要。

---

## AWS Storage Gateway

オンプレミスとAWSストレージを繋ぐサービス

### 3つのゲートウェイタイプ

| タイプ | 見え方 | 保存先 | 主な用途 |
|-------|-------|-------|---------|
| File Gateway | ファイル共有 | S3 | ファイルサーバー |
| Volume Gateway | HDD | S3/EBS | ディスクバックアップ |
| Tape Gateway | テープ | Glacier | テープ置き換え |

### Tape Gateway
- 物理的な磁気テープをクラウドのデータに置き換える
- バックアップソフトからは物理テープに見える
- 実際は S3 / Glacier に保存
- 物理テープの購入・保管・輸送が不要に
- CD/DVD は対象外（磁気テープ専用）

### Volume Gateway の2つのモード
- **キャッシュ型**：データはS3に保存、よく使うものだけローカルにキャッシュ
- **保管型**：データはローカルに保存、非同期でS3にバックアップ
