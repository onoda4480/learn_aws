# データ処理・分析

## Amazon EMR（Elastic MapReduce）

大量のデータを複数台で分散処理するサービス

### 仕組み
```
10TBのデータを処理したい

  ノード1：2TB分を担当
  ノード2：2TB分を担当
  ノード3：2TB分を担当 → 並列で処理 → 圧倒的に速い
  ノード4：2TB分を担当
  ノード5：2TB分を担当
```

### クラスター構成

| ノード種別 | 役割 | 台数 |
|----------|------|------|
| マスター | 全体管理・ジョブ振り分け | 1台 |
| コア | データ保持 + 処理実行 | 必須（複数台） |
| タスク | 処理だけ手伝う（データは持たない） | 任意（増減可能） |

### EMR上で動くツール
- Apache Spark（最もよく使う）
- Apache Hive（SQLで集計）
- Presto（高速クエリ）
- Apache Flink（リアルタイム）

### 実行方式

| 方式 | 特徴 |
|-----|------|
| EMR on EC2（従来型） | 自分でクラスター構成を管理 |
| EMR Serverless（おすすめ） | 管理不要、ジョブ投げるだけ |
| EMR on EKS | 既存のEKSクラスター上で動かす |

### 用途
- 大規模なログ分析
- 機械学習の前処理
- 大量データのETL

---

## AWS Glue

サーバーレスのETLサービス（EMRの簡単版）

### ETL とは
```
E：Extract（抽出）   → データを取り出す
T：Transform（変換）  → データを加工する
L：Load（ロード）     → 別の場所に入れる
```

### 特徴
- サーバーレス（管理不要）
- 中身はSpark（EMRと同じエンジン）
- PythonまたはScalaで書ける
- スケジュール実行可能

### EMR との違い
```
EMR  = 自分でSparkクラスターを構築・管理（自由度高い）
Glue = AWSがSparkクラスターを勝手に用意（簡単）
```

---

## データ処理サービスの使い分け

| やりたいこと | 最適なサービス |
|------------|--------------|
| ちょっとした集計 | Athena（S3にSQLを投げるだけ） |
| 定常的な分析 | Redshift（データウェアハウス） |
| データ変換パイプライン | Glue（サーバーレスETL） |
| 大規模・複雑な処理 | EMR（何でもできる） |
| 単純なDB→DB移行 | DMS（専用ツール） |

---

## Amazon DataZone

組織内のデータを「見つけやすく・共有しやすく・安全に使える」ようにするサービス

### 本質は2つ
1. **データの利用申請**：使いたい人が申請、持ってる人が承認
2. **項目を絞って提供**：見せていいカラムだけ公開

### 機能
- データカタログ（どんなデータがあるか一覧化・検索）
- アクセス管理（誰がどのデータを使えるか）
- データ共有（部署間でデータをやり取り）
- ガバナンス（ルールに沿った運用を強制）

### 位置づけ
```
利用者 → 非エンジニアでもOK（カタログ検索・申請するだけ）
構築側 → エンジニアが必要（データソース接続・ポリシー設計）

「AWSインフラの上に乗るビジネスツール」
```

---

## RDS マルチAZ配置 vs マルチAZ DBクラスター配置

| 項目 | マルチAZ配置 | マルチAZ DBクラスター |
|-----|------------|-------------------|
| 構成 | プライマリ + スタンバイ1台 | ライター1台 + リーダー2台 |
| スタンバイの利用 | **使えない（待機のみ）** | **読み取りに使える** |
| フェイルオーバー | 60〜120秒 | 約35秒 |
| AZ数 | 2つ | 3つ |
| 読み取り負荷分散 | できない | できる |

### 選び方
- **マルチAZ配置**：シンプルに冗長化、コスト抑えたい
- **マルチAZ DBクラスター**：高速フェイルオーバー、読み取り分散が必要
